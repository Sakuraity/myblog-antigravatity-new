---
import { ViewTransitions } from 'astro:transitions';
import SEO from '../components/SEO.astro';
import Search from '../components/Search.astro';
// Import Fonts
import '@fontsource/playfair-display/400.css';
import '@fontsource/playfair-display/700.css';
import '@fontsource/noto-serif-sc/400.css';
import '@fontsource/noto-serif-sc/700.css';
import '@fontsource/inter/400.css';
import '@fontsource/inter/600.css';

interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="zh-CN" class="scroll-smooth">
	<head>
		<SEO title={title} />
		<ViewTransitions />
		<script is:inline>
			// Dark mode initialization - 封装为函数
			function applyTheme() {
				const theme = (() => {
					if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
						return localStorage.getItem('theme');
					}
					if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
						return 'dark';
					}
					return 'light';
				})();
			
				if (theme === 'dark') {
					document.documentElement.classList.add('dark');
				} else {
					document.documentElement.classList.remove('dark');
				}
			
				window.localStorage.setItem('theme', theme);
			}
			
			// 立即应用主题（防止闪烁）
			applyTheme();
			
			// View Transitions 支持 - 在每次页面切换后重新应用主题
			document.addEventListener('astro:after-swap', applyTheme);
		</script>
	</head>
	<body class="bg-bg-light dark:bg-bg-dark text-text-light dark:text-text-dark font-sans antialiased min-h-screen flex flex-col transition-colors duration-300">
		<header class="sticky top-0 z-50 w-full border-b border-black/5 dark:border-white/10 bg-bg-light/80 dark:bg-bg-dark/80 backdrop-blur-md">
			<div class="max-w-6xl mx-auto px-6 h-16 grid grid-cols-12 items-center">
				<!-- Left: Logo -->
				<div class="col-span-3 flex justify-start">
					<a href="/" class="font-serif text-xl font-bold tracking-tight hover:text-primary transition-colors">
						Kangyuan's Blog
					</a>
				</div>
				
				<!-- Center: Nav -->
				<div class="col-span-6 flex justify-center">
					<nav class="flex items-center gap-8 text-sm font-medium text-text-muted-light dark:text-text-muted-dark">
					<a href="/" class="hover:text-text-light dark:hover:text-text-dark transition-colors relative group">
						Home
						<span class="absolute -bottom-1 left-0 w-0 h-px bg-primary transition-all group-hover:w-full"></span>
					</a>
					<a href="/works" class="hover:text-text-light dark:hover:text-text-dark transition-colors relative group">
						Works
						<span class="absolute -bottom-1 left-0 w-0 h-px bg-primary transition-all group-hover:w-full"></span>
					</a>
					<a href="/library" class="hover:text-text-light dark:hover:text-text-dark transition-colors relative group">
						Library
						<span class="absolute -bottom-1 left-0 w-0 h-px bg-primary transition-all group-hover:w-full"></span>
					</a>
					<a href="/blog" class="hover:text-text-light dark:hover:text-text-dark transition-colors relative group">
						Blog
						<span class="absolute -bottom-1 left-0 w-0 h-px bg-primary transition-all group-hover:w-full"></span>
					</a>
					<a href="/notes" class="hover:text-text-light dark:hover:text-text-dark transition-colors relative group">
						Notes
						<span class="absolute -bottom-1 left-0 w-0 h-px bg-primary transition-all group-hover:w-full"></span>
					</a>
					<a href="/about" class="hover:text-text-light dark:hover:text-text-dark transition-colors relative group">
						About
						<span class="absolute -bottom-1 left-0 w-0 h-px bg-primary transition-all group-hover:w-full"></span>
					</a>
				</nav>
				</div>
				
				<!-- Right: Search & Theme -->
				<div class="col-span-3 flex justify-end items-center gap-4">
					<div class="relative group">
						<Search />
					</div>
					<div class="w-px h-4 bg-gray-200 dark:bg-gray-700"></div>
					<!-- Theme Toggle Button -->
					<button id="theme-toggle" aria-label="Toggle Dark Mode" class="p-2 -mr-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors text-text-muted-light dark:text-text-muted-dark hover:text-text-light dark:hover:text-text-dark">
						<svg class="sun block dark:hidden w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
						<svg class="moon hidden dark:block w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 24.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
					</button>
				</div>
			</div>
		</header>

		<main class="flex-grow w-full max-w-6xl mx-auto px-6 py-12">
			<slot />
		</main>

		<footer class="border-t border-black/5 dark:border-white/10 py-8 text-center text-sm text-text-muted-light dark:text-text-muted-dark">
			<p>&copy; {new Date().getFullYear()} Kangyuan's Blog. 版权所有.</p>
		</footer>

		<script>
		// Theme Toggle Logic
		const handleToggleClick = () => {
			const element = document.documentElement;
			element.classList.toggle("dark");
			
			const isDark = element.classList.contains("dark");
			localStorage.setItem("theme", isDark ? "dark" : "light");
		}

		// View Transitions support - 防止重复添加监听器
		function initThemeToggle() {
			const btn = document.getElementById("theme-toggle");
			if (btn && !btn.dataset.initialized) {
				btn.addEventListener("click", handleToggleClick);
				btn.dataset.initialized = "true";
			}
		}
		
		document.addEventListener('astro:page-load', initThemeToggle);
	</script>
	</body>
</html>
