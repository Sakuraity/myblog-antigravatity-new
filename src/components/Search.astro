---
---
<div id="search" class="search-container"></div>

<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js" is:inline></script>

<script>
    function initPagefind() {
        const searchEl = document.getElementById('search');
        if (searchEl && !searchEl.querySelector('.pagefind-ui')) {
            // @ts-ignore
            new PagefindUI({ 
                element: "#search", 
                showImages: false,
                translations: {
                    placeholder: "搜索...",
                    clear_search: "清除",
                    load_more: "加载更多",
                    search_label: "搜索",
                    filters_label: "筛选",
                    zero_results: "没有找到相关内容",
                    many_results: "找到 [COUNT] 篇相关内容",
                    one_result: "找到 1 篇相关内容",
                    alt_search: "未找到结果，显示相似内容",
                    search_suggestion: "试试搜索 [SUGGESTION]",
                    searching: "搜索中..."
                }
            });
        }
    }

    document.addEventListener('astro:page-load', initPagefind);
    if (document.readyState === 'complete') {
        initPagefind();
    } else {
        window.addEventListener('DOMContentLoaded', initPagefind);
    }
</script>

<style is:global>
    /* ============================================
       Minimalist Search Theme
       ============================================ */
    
    .search-container {
        --pagefind-ui-scale: 0.8;
        --pagefind-ui-primary: #1a1a1a;
        --pagefind-ui-text: #333;
        --pagefind-ui-background: #fff;
        --pagefind-ui-border: #e5e5e5;
        --pagefind-ui-tag: #f5f5f5;
        --pagefind-ui-border-width: 1px;
        --pagefind-ui-border-radius: 6px;
        --pagefind-ui-font: "Inter", system-ui, sans-serif;
    }

    html.dark .search-container {
        --pagefind-ui-primary: #fff;
        --pagefind-ui-text: #e5e5e5;
        --pagefind-ui-background: #1a1a1a;
        --pagefind-ui-border: #333;
        --pagefind-ui-tag: #262626;
    }

    /* Hide default search icon */
    .pagefind-ui__form::before {
        display: none !important;
    }

    /* Input Field - Clean & Minimal */
    .pagefind-ui__search-input {
        background: var(--pagefind-ui-background) !important;
        border: 1px solid var(--pagefind-ui-border) !important;
        border-radius: 8px !important;
        padding: 0.625rem 1rem !important;
        font-size: 0.875rem !important;
        font-weight: 400 !important;
        color: var(--pagefind-ui-text) !important;
        transition: border-color 0.15s ease, box-shadow 0.15s ease !important;
        width: 200px !important;
    }

    .pagefind-ui__search-input::placeholder {
        color: #999 !important;
        opacity: 1 !important;
    }

    html.dark .pagefind-ui__search-input::placeholder {
        color: #666 !important;
    }

    .pagefind-ui__search-input:focus {
        outline: none !important;
        border-color: #999 !important;
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05) !important;
    }

    html.dark .pagefind-ui__search-input:focus {
        border-color: #555 !important;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.05) !important;
    }

    /* Clear Button - X Icon */
    .pagefind-ui__search-clear {
        background: transparent !important;
        color: #999 !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        right: 0.75rem !important;
        width: 20px !important;
        height: 20px !important;
        padding: 0 !important;
        font-size: 0 !important; /* Hide text */
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        border-radius: 50% !important;
        transition: background 0.15s ease, color 0.15s ease !important;
    }

    .pagefind-ui__search-clear::before {
        content: "×" !important;
        font-size: 18px !important;
        line-height: 1 !important;
        font-weight: 300 !important;
    }

    .pagefind-ui__search-clear:hover {
        color: #333 !important;
        background: rgba(0, 0, 0, 0.05) !important;
    }

    html.dark .pagefind-ui__search-clear:hover {
        color: #fff !important;
        background: rgba(255, 255, 255, 0.1) !important;
    }

    /* Results Dropdown */
    .pagefind-ui__drawer {
        position: absolute !important;
        top: calc(100% + 8px) !important;
        right: 0 !important;
        left: auto !important;
        width: 360px !important;
        max-height: 480px !important;
        overflow-y: auto !important;
        background: var(--pagefind-ui-background) !important;
        border: 1px solid var(--pagefind-ui-border) !important;
        border-radius: 12px !important;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04) !important;
        padding: 0.75rem !important;
        z-index: 1000 !important;
    }

    html.dark .pagefind-ui__drawer {
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2) !important;
    }

    /* Results Message */
    .pagefind-ui__message {
        font-size: 0.75rem !important;
        color: #999 !important;
        padding: 0.5rem 0.25rem !important;
        border-bottom: 1px solid var(--pagefind-ui-border) !important;
        margin-bottom: 0.5rem !important;
    }

    /* Individual Result */
    .pagefind-ui__result {
        padding: 0.75rem !important;
        margin: 0 !important;
        border: none !important;
        border-radius: 8px !important;
        transition: background 0.1s ease !important;
    }

    .pagefind-ui__result:hover {
        background: var(--pagefind-ui-tag) !important;
    }

    .pagefind-ui__result-thumb {
        display: none !important;
    }

    .pagefind-ui__result-inner {
        margin-top: 0 !important;
    }

    .pagefind-ui__result-title {
        font-size: 0.9375rem !important;
        font-weight: 500 !important;
        margin-bottom: 0.25rem !important;
        line-height: 1.4 !important;
    }

    .pagefind-ui__result-title a {
        color: var(--pagefind-ui-text) !important;
        text-decoration: none !important;
    }

    .pagefind-ui__result-title a:hover {
        text-decoration: underline !important;
    }

    .pagefind-ui__result-excerpt {
        font-size: 0.8125rem !important;
        line-height: 1.5 !important;
        color: #666 !important;
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
    }

    html.dark .pagefind-ui__result-excerpt {
        color: #888 !important;
    }

    /* Highlight */
    .pagefind-ui__result-excerpt mark {
        background: rgba(255, 220, 0, 0.3) !important;
        color: inherit !important;
        padding: 0 2px !important;
        border-radius: 2px !important;
    }

    html.dark .pagefind-ui__result-excerpt mark {
        background: rgba(255, 220, 0, 0.2) !important;
    }

    /* Tags */
    .pagefind-ui__result-tag {
        font-size: 0.6875rem !important;
        padding: 0.125rem 0.5rem !important;
        border-radius: 4px !important;
        background: var(--pagefind-ui-tag) !important;
        color: #666 !important;
        margin-right: 0.25rem !important;
    }

    html.dark .pagefind-ui__result-tag {
        color: #999 !important;
    }

    /* Load More Button */
    .pagefind-ui__button {
        background: transparent !important;
        border: 1px solid var(--pagefind-ui-border) !important;
        color: var(--pagefind-ui-text) !important;
        font-size: 0.8125rem !important;
        padding: 0.5rem 1rem !important;
        border-radius: 6px !important;
        margin-top: 0.5rem !important;
        cursor: pointer !important;
        transition: background 0.1s ease !important;
    }

    .pagefind-ui__button:hover {
        background: var(--pagefind-ui-tag) !important;
    }

    /* Responsive: Scrollbar */
    .pagefind-ui__drawer::-webkit-scrollbar {
        width: 6px;
    }

    .pagefind-ui__drawer::-webkit-scrollbar-track {
        background: transparent;
    }

    .pagefind-ui__drawer::-webkit-scrollbar-thumb {
        background: #ddd;
        border-radius: 3px;
    }

    html.dark .pagefind-ui__drawer::-webkit-scrollbar-thumb {
        background: #444;
    }
</style>
