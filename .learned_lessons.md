# Learned Lessons

## 2025

---

### ğŸ›¡ï¸ æ–‡ä»¶ä¸é…ç½®å®‰å…¨

- [2025-12-17] **é™æ€èµ„æºä¸é…ç½®çš„å‘½å/ç”Ÿæˆå®‰å…¨**: 
  1. ç¨‹åºåŒ–ç”Ÿæˆ YAML/JSON é…ç½®æ–‡ä»¶æ—¶ï¼Œå¿…é¡»å¯¹åŠ¨æ€å†…å®¹ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå°¤å…¶æ˜¯å¼•å·ï¼‰è¿›è¡Œè½¬ä¹‰ï¼Œé˜²æ­¢è¯­æ³•ç ´åå¯¼è‡´æ„å»ºå¤±è´¥ã€‚
  2. ä¸¥ç¦åœ¨æ–‡ä»¶æˆ–ç›®å½•åä¸­ä½¿ç”¨ URL ä¿ç•™å­—ç¬¦ï¼ˆå¦‚ `#`, `?`, `&`ï¼‰ï¼Œè¿™å°†å¯¼è‡´ Vite/Rollup æ¨¡å—è§£æå¤±è´¥ï¼ˆError: `Rollup failed to resolve import`ï¼‰ã€‚Content Collection çš„æ–‡ä»¶å‘½ååº”ä¿æŒç®€æ´ï¼Œä»…åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡ã€è¿å­—ç¬¦æˆ–ä¸‹åˆ’çº¿ã€‚

- [2025-12-17] **é˜²å¾¡æ€§æ•°æ®å¤„ç†**: å¤„ç†å¯é€‰çš„æ•°ç»„æ•°æ®ï¼ˆå¦‚ CMS å†…å®¹æ ‡ç­¾ï¼‰æ—¶ï¼Œå§‹ç»ˆæä¾›é»˜è®¤å€¼ï¼ˆå¦‚ `|| []`ï¼‰ä»¥é˜²æ­¢ `undefined` å¯¼è‡´çš„è¿è¡Œæ—¶æˆ–æ„å»ºé”™è¯¯ã€‚

---

### ğŸ“š Astro Content Collection

- [2025-12-17] **Content Schema å®šä¹‰è§„èŒƒ**:
  1. åœ¨ `config.ts` å®šä¹‰å›¾ç‰‡å­—æ®µæ—¶ï¼Œè‹¥éœ€æ”¯æŒæœ¬åœ°è·¯å¾„ï¼Œä¸å¯ä»…ä½¿ç”¨ `z.string().url()`ï¼ˆä¼šæŠ¥é”™ `Invalid url`ï¼‰ã€‚å¿…é¡»æ”¾å®½ä¸º `z.string()` æˆ–ä½¿ç”¨ `z.union([image(), z.string()])` ä»¥å…¼å®¹æœ¬åœ°ç›¸å¯¹/ç»å¯¹è·¯å¾„ã€‚
  2. å½“ä½¿ç”¨ `image()` ç­‰ helper æ—¶ï¼Œå¿…é¡»å°† `schema` å®šä¹‰ä¸ºæ¥æ”¶ context çš„å‡½æ•°å½¢å¼ `schema: ({ image }) => z.object({...})`ï¼Œè€Œéç›´æ¥ä¼ å…¥ `z.object`ï¼Œå¦åˆ™ä¼šæŠ¥é”™ helper æœªå®šä¹‰ã€‚
  3. ä½¿ç”¨ `z.string().url().optional()` å®šä¹‰å¯é€‰ URL å­—æ®µã€‚

- [2025-12-19] **Content æ•°æ®ä½¿ç”¨è§„èŒƒ**:
  1. åœ¨ content collection ä¸­æ·»åŠ å¯é€‰å­—æ®µï¼ˆå¦‚ `audioUrl`ï¼‰æ—¶ï¼Œéœ€åŒæ­¥æ›´æ–°ä¸‰å¤„ï¼š`config.ts` schema æ·»åŠ å­—æ®µå®šä¹‰ã€å†…å®¹ç”Ÿæˆ/å¯¼å…¥è„šæœ¬æ”¯æŒæå–å’Œå†™å…¥è¯¥å­—æ®µã€é¡µé¢æ¨¡æ¿æ¡ä»¶æ¸²æŸ“å¯¹åº”ç»„ä»¶ã€‚
  2. `getCollection` è¿”å›çš„ `entry.body` ä»…ä¸º Markdown æºç å­—ç¬¦ä¸²ã€‚è‹¥éœ€æ¸²æŸ“å¯Œæ–‡æœ¬ï¼ˆHTMLã€å›¾ç‰‡ã€ç»„ä»¶ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ `{ Content } = await entry.render()` å¹¶æ¸²æŸ“ `<Content />` ç»„ä»¶ï¼Œè€Œä¸èƒ½ç®€å•åœ° `set:html={entry.body}`ã€‚

---

### ğŸ”„ Astro View Transitions

- [2025-12-18] **View Transitions å¼€å‘è§„èŒƒ**:
  1. **ç”Ÿå‘½å‘¨æœŸäº‹ä»¶**: ä½¿ç”¨ `ViewTransitions` æ—¶ï¼Œ`DOMContentLoaded` äº‹ä»¶ä¸ä¼šåœ¨è½¯å¯¼èˆªåè§¦å‘ã€‚éœ€ä½¿ç”¨ `astro:page-load`ï¼ˆæ¯æ¬¡æ–°é¡µé¢å¯è§æ—¶ï¼‰å’Œ `astro:after-swap`ï¼ˆDOM æ›¿æ¢åç«‹å³æ‰§è¡Œï¼‰æ¥ç¡®ä¿è„šæœ¬æ­£ç¡®é‡æ–°æ‰§è¡Œã€‚
  2. **ä¸»é¢˜/çŠ¶æ€æŒä¹…åŒ–**: ä¸»é¢˜åˆå§‹åŒ–ç­‰é˜²é—ªçƒé€»è¾‘åº”æ”¾åœ¨ `<head>` ä½¿ç”¨ `is:inline` æ ‡è®°ï¼Œå¹¶ç›‘å¬ `astro:after-swap` ä»¥ä¿æŒè·¨é¡µçŠ¶æ€ã€‚
  3. **é˜²æ­¢å†…å­˜æ³„æ¼**: åœ¨ `astro:page-load` å›è°ƒä¸­ç›´æ¥æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ä¼šå¯¼è‡´æ¯æ¬¡å¯¼èˆªéƒ½é‡å¤æ·»åŠ ã€‚è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `element.dataset.initialized` æ ‡è®°é˜²æ­¢é‡å¤ç»‘å®šï¼Œæˆ–åœ¨æ·»åŠ æ–°ç›‘å¬å™¨å‰å…ˆç§»é™¤æ—§ç›‘å¬å™¨ã€‚

---

### ğŸ” Pagefind æœç´¢é›†æˆ

- [2025-12-19] **Pagefind UI Customization**: ä½¿ç”¨ Pagefind é»˜è®¤ UI æ—¶ï¼Œå¯é€šè¿‡ CSS å˜é‡ (`--pagefind-ui-primary`, etc.) è¿›è¡Œæ·±åº¦å®šåˆ¶ã€‚è‹¥éœ€æ›´æ¿€è¿›çš„ä¿®æ”¹ï¼ˆå¦‚ç§»é™¤å›¾æ ‡ã€ç¼©ç•¥å›¾ï¼‰ï¼Œå¯ä½¿ç”¨ `!important` è¦†ç›– CSS ç±»ï¼Œæˆ–éšè—ç‰¹å®šå…ƒç´  (`display: none`)ã€‚è¦å®ç° Modal äº¤äº’ï¼Œå¯å°† Pagefind å®¹å™¨ç½®äº `<dialog>` ä¸­ï¼Œå°è£… `open`/`close` æ–¹æ³•å¹¶ç»‘å®šé”®ç›˜å¿«æ·é”® (`Cmd+K`)ã€‚

- [2025-12-19] **Astro Pagefind Indexing Scope**: Pagefind é»˜è®¤å°è¯•ç´¢å¼• `data-pagefind-body` å…ƒç´ ã€‚è‹¥æœªæ‰¾åˆ°ï¼Œä¼šé™çº§ç´¢å¼•æ•´ä¸ª `<body>` å¹¶å‘å‡ºæ„å»ºè­¦å‘Šã€‚åœ¨ä¸»å†…å®¹åŒºåŸŸï¼ˆå¦‚ `<main>`ï¼‰æ˜¾å¼æ·»åŠ  `data-pagefind-body` å±æ€§å¯æ¶ˆé™¤è­¦å‘Šå¹¶æé«˜æœç´¢ç»“æœçš„ç›¸å…³æ€§ï¼Œé¿å…ç´¢å¼•é¡µè„šæˆ–å¯¼èˆªæ æ— å…³å†…å®¹ã€‚

---

### ğŸ¨ CSS ä¸æ ·å¼æŠ€å·§

- [2025-12-19] **CSS Mimicry for Branded Typography**: When implementing branded aesthetics (e.g., Stranger Things) without access to proprietary fonts, use CSS `text-shadow` layers and `-webkit-text-stroke` on standard serif fonts to mimic the visual style. Isolate these heavy styles in specific components.

- [2025-12-19] **CSS Variable Staggering**: When creating complex animations for a collection of elements (e.g., blinking lights for an alphabet wall), use inline styles to set a CSS variable for the index and use `calc()` in the CSS animation delay. This keeps the JS clean.

---

### ğŸ–±ï¸ UX äº¤äº’æ¨¡å¼

- [2025-12-19] **åˆ—è¡¨é¡¹å±•å¼€äº¤äº’æ¨¡å¼ (Accordion + Focus)**:
  1. **æ‰‹é£ç´ä¸è‡ªåŠ¨æ»šåŠ¨**: åœ¨å®ç°é•¿åˆ—è¡¨ï¼ˆå¦‚ç¬”è®°/æ–‡ç« é¢„è§ˆï¼‰çš„"å±•å¼€/æ”¶èµ·"æ‰‹é£ç´äº¤äº’æ—¶ï¼ŒåŠ¡å¿…é…åˆ `scrollIntoView({ behavior: 'smooth', block: 'start' })`ã€‚å› ä¸ºæ”¶èµ·å…¶ä»–å¡ç‰‡ä¼šå¯¼è‡´é¡µé¢é«˜åº¦éª¤å˜ï¼Œä½¿ç”¨æˆ·è¿·å¤±ç„¦ç‚¹ã€‚åˆ©ç”¨ `setTimeout` ç¨å¾®å»¶è¿Ÿæ»šåŠ¨ä»¥ç­‰å¾… CSS å¸ƒå±€å˜åŒ–ç¨³å®šï¼Œå¹¶ä¸ºç›®æ ‡å®¹å™¨è®¾ç½® `scroll-margin-top` ä»¥é€‚åº” Sticky Headerã€‚
  2. **Dim Others Focus**: é¿å…ä½¿ç”¨çªå…€çš„é«˜äº®åŠ¨ç”»ï¼ˆå¦‚ glowing borderï¼‰ã€‚é‡‡ç”¨"å…¶ä»–é¡¹å˜æš— (Dim Others)"çš„æ¨¡å¼ï¼ˆå³ç»™å®¹å™¨æ·»åŠ çŠ¶æ€ç±»ï¼Œé™ä½é active é¡¹çš„ opacityï¼‰èƒ½æä¾›æ›´æ²‰æµ¸ã€é«˜çº§çš„é˜…è¯»ä½“éªŒï¼Œä¸”é€šè¿‡ CSS `transition` å®ç°å¹³æ»‘è¿‡æ¸¡ï¼Œè§†è§‰å¹²æ‰°æœ€å°ã€‚

- [2025-12-19] **Conditional UI Truncation**: å®ç°"é˜…è¯»æ›´å¤š"æˆªæ–­åŠŸèƒ½æ—¶ï¼Œè‹¥ä¾èµ–é™æ€ CSS (`max-height`)ï¼Œå¯èƒ½å¯¼è‡´çŸ­å†…å®¹ä¸‹æ–¹ä»æ˜¾ç¤ºæˆªæ–­é®ç½©å’ŒæŒ‰é’®ã€‚åº”åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ JS æ¯”è¾ƒ `scrollHeight > clientHeight`ï¼Œä»…åœ¨ç¡®å®æº¢å‡ºæ—¶æ˜¾ç¤ºäº¤äº’ç»„ä»¶ï¼Œç¡®ä¿ UI çš„æ•´æ´ä¸åˆç†æ€§ã€‚

- [2025-12-18] **åµŒå¥—äº¤äº’å…ƒç´ å±‚çº§**: å½“çˆ¶å®¹å™¨æ˜¯ä¸€ä¸ªå¤§é“¾æ¥ï¼ˆå¦‚ä½¿ç”¨ absolute inset-0 è¦†ç›–çš„å¡ç‰‡ï¼‰æ—¶ï¼Œå†…éƒ¨çš„äº¤äº’å…ƒç´ ï¼ˆå¦‚æ ‡ç­¾é“¾æ¥ã€æŒ‰é’®ï¼‰å¿…é¡»è®¾ç½® `relative` å’Œè¾ƒé«˜çš„ `z-index`ï¼ˆå¦‚ `z-10`ï¼‰ï¼Œå¦åˆ™ç‚¹å‡»äº‹ä»¶ä¼šè¢«çˆ¶å®¹å™¨çš„é®ç½©å±‚æ•è·ï¼Œå¯¼è‡´å†…éƒ¨é“¾æ¥å¤±æ•ˆã€‚

---

### ğŸµ åª’ä½“ç»„ä»¶å¼€å‘

- [2025-12-18] **HTML5 Audio æ’­æ”¾å™¨å¼€å‘**: åˆ›å»ºè‡ªå®šä¹‰éŸ³é¢‘æ’­æ”¾å™¨æ—¶ï¼Œä½¿ç”¨ `new Audio(url)` åˆ›å»ºéŸ³é¢‘å¯¹è±¡ï¼Œé€šè¿‡ç›‘å¬ `play`ã€`pause`ã€`timeupdate`ã€`loadedmetadata`ã€`ended` äº‹ä»¶æ›´æ–° UIã€‚è¿›åº¦æ¡ç‚¹å‡»äº‹ä»¶éœ€è®¡ç®—ç‚¹å‡»ä½ç½®ç™¾åˆ†æ¯”å¹¶è®¾ç½® `audio.currentTime = percent * audio.duration`ã€‚

---

### âš™ï¸ TypeScript ä¸æ„å»º

- [2025-12-18] **TypeScript in Astro Scripts**: Astro ç»„ä»¶å†…çš„ `<script>` æ ‡ç­¾è‹¥ä½¿ç”¨ TypeScript (é»˜è®¤å¯ç”¨)ï¼Œå¿…é¡»ä¸ºæ‰€æœ‰å‡½æ•°å‚æ•°æä¾›æ˜ç¡®çš„ç±»å‹æ³¨è§£ï¼ˆå¦‚ `(id: string, value: number)`ï¼‰ï¼Œå¦åˆ™ä¼šå›  `noImplicitAny` è§„åˆ™å¯¼è‡´æ„å»ºæŠ¥é”™ `Parameter implicitly has an 'any' type`ã€‚æ„å»ºæµç¨‹æ¯” `npm run dev` æ›´ä¸¥æ ¼ï¼Œå¼€å‘æ—¶åº”ç•™æ„ç±»å‹å®Œæ•´æ€§ã€‚

- [2025-12-18] **Astro è‡ªåŠ¨ç”Ÿæˆç±»å‹ç»´æŠ¤**: `.astro/` ç›®å½•å­˜æ”¾ Astro è‡ªåŠ¨ç”Ÿæˆçš„ TS ç±»å‹æ–‡ä»¶ï¼ˆå¦‚ `content.d.ts`ï¼‰ã€‚å¦‚æœé‡åˆ°å†…å®¹é›†åˆç±»å‹ä¸¢å¤±ã€æ–‡ä»¶è¢«æ¸…ç©ºæˆ–ä¸ä¸€è‡´ï¼Œå¯è¿è¡Œ `npx astro sync` å¼ºåˆ¶åˆ·æ–°ã€‚ä¸ºé¿å… Git æäº¤å¹²æ‰°ï¼Œå»ºè®®åœ¨ `.gitignore` ä¸­å¿½ç•¥ `.astro/`ï¼ˆé™¤éå›¢é˜Ÿæ˜ç¡®è¦æ±‚åŒæ­¥ç±»å‹å®šä¹‰ï¼‰ã€‚

---

### ğŸ macOS Automation

- [2025-12-18] **macOS Automation å¼€å‘æŠ€å·§**:
  1. **é¿å…ç¡¬ç¼–ç è·¯å¾„**: When creating macOS automations or apps (like `.app` bundles wrapping scripts), avoid hardcoding absolute paths (e.g., `/Users/username/Docs/...`). Use dynamic path resolution (e.g., `POSIX path of (path to me)`) or environment variables to ensure the app works across different machines or directory structures.
  2. **Applet åç¼–è¯‘ä¸é‡å»º**: Use `osadecompile` to read the source of a compiled AppleScript `.app` (specifically `Contents/Resources/Scripts/main.scpt`). Use `osacompile` to rebuild it to fix binary issues or update logic.

---

### ğŸ”§ è„šæœ¬ä¸ç¯å¢ƒ

- [2025-12-18] **Environment Variables in Standalone Scripts**: When running standalone Node.js scripts (e.g., `node scripts/task.mjs`) that depend on `.env` files, verify if the script uses `dotenv` or relies on the shell/caller to load variables. If verified via `node`, ensure you export the variables first (e.g., `export $(cat .env | xargs)`) to avoid false negatives where the script works in the full pipeline (which sources .env) but fails in isolation.

---

### ğŸ¤– è‡ªåŠ¨åŒ–ä¸å†…å®¹æå–

- [2025-12-22] **åŸºäº Browser Agent çš„ç¤¾äº¤åª’ä½“æå–**: åœ¨å®ç°å³åˆ» (Jike) ç­‰åŠ¨æ€é¡µé¢çš„è‡ªåŠ¨åŒ–ç¬”è®°æå–æ—¶ï¼Œç›´æ¥ä½¿ç”¨ `read_url_content` å¾€å¾€æ— æ³•è·å–ç”± JS æ¸²æŸ“çš„å†…å®¹ã€‚åº”ä½¿ç”¨ `browser_subagent` å¯¼èˆªå¹¶æ˜¾å¼æ‰§è¡Œ JS æ¥æå– DOM æ•°æ®ï¼ˆå¦‚ä¸‹æ ‡ä¸º `img` çš„ `src`ï¼‰ã€‚ç”Ÿæˆçš„ Markdown åº”ä½¿ç”¨æ ‡å‡† `![image](url)` è¯­æ³•ä»¥ä¿è¯åœ¨ Content Collection æ¸²æŸ“æ—¶çš„è·¨å¹³å°å…¼å®¹æ€§ã€‚

- [2025-12-29] **DOM æå–çš„ç‰¹å¼‚æ€§ç­–ç•¥**: åœ¨æå–ç±»åæ··æ·†ï¼ˆå¦‚ `jk-18tsg9e`ï¼‰çš„ç¤¾äº¤åª’ä½“å†…å®¹æ—¶ï¼Œé¿å…ä¾èµ–ä¸ç¨³å®šçš„ CSS ç±»é€‰æ‹©å™¨ã€‚æ›´ç¨³å¥çš„ç­–ç•¥æ˜¯åˆ©ç”¨ DOM ç»“æ„å…³ç³»ï¼ˆå¦‚å®šä½å·²çŸ¥å…ƒç´ å¦‚å¤´åƒçš„çˆ¶å®¹å™¨ï¼‰æˆ–ç‰¹å®šçš„è¯­ä¹‰æ–‡æœ¬æ ‡è®°ï¼ˆText Markersï¼‰æ¥å®šä½æ ¸å¿ƒå†…å®¹ã€‚

- [2025-12-29] **Astro Content Collection è·¯ç”±å‘½å**: å½“ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼ˆ`pages/posts/[...slug].astro`ï¼‰ä¸”æœªè¦åœ¨ frontmatter ä¸­æ˜¾å¼æŒ‡å®š `slug` æ—¶ï¼ŒURL è·¯å¾„ç›´æ¥å–è‡ªæ–‡ä»¶å¤¹åç§°ã€‚è‹¥æ–‡ä»¶å¤¹åä¸ºä¸­æ–‡ï¼ˆå¦‚ `å…³äºäº§å“çš„æ€è€ƒ`ï¼‰ï¼ŒURL ä¼šè¢«ç¼–ç ä¸”ä¸ç¾è§‚ã€‚åº”å§‹ç»ˆä½¿ç”¨è‹±æ–‡ kebab-case å‘½åæ–‡ä»¶å¤¹ï¼ˆå¦‚ `2025-year-end-review`ï¼‰ä»¥ç”Ÿæˆå¹²å‡€çš„ URLï¼Œä¸­æ–‡æ ‡é¢˜ä¿ç•™åœ¨ frontmatter `title` å­—æ®µä¸­å³å¯ã€‚
